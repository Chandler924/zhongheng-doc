<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>API设计指南 | 纵横框架文档</title><meta name="description" content="纵横前端和后端框架的完整文档">
    <link rel="preload" href="/zongheng-doc/assets/style-C2JCxPSn.css" as="style"><link rel="stylesheet" href="/zongheng-doc/assets/style-C2JCxPSn.css">
    <link rel="modulepreload" href="/zongheng-doc/assets/app-Ct3TXeMg.js"><link rel="modulepreload" href="/zongheng-doc/assets/api-design.html-BrT2poSJ.js">
    <link rel="prefetch" href="/zongheng-doc/assets/deployment.html-CicdJI17.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/index.html-DJz_eqGf.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/getting-started.html-DXtTIFfN.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/overview.html-B0OT5C8e.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/getting-started.html-BRLiZGJ2.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/state-management.html-wXXeLepR.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/index.html-D7jvQTep.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-add-button.html-FYKCQKZC.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-app-icon.html-BkK4VmOz.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-app-panel.html-zrkfADO9.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-app-title-bar.html-DfKj0UFj.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-back-button.html-frVAmEBI.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-batch-delete-button.html-BVPBbup7.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-cancel-button.html-Me6kIn7K.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-check-role.html-DDNeup8I.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-check-unit.html-CFBitSUI.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-check-user.html-BnpIhbEG.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-checkbox.html-pDzGUFkp.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-clear-button.html-CeHRhqab.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-date.html-BmE1Tji1.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-description.html-DoULi4m-.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-email.html-BLC1mxqv.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-export-button.html-CQzoWDY1.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-file-upload.html-nf2Akvnd.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-idcard.html-htc-Ph_d.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-image-upload.html-BXkeJybK.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-import-button.html-xsUTLWoG.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-input.html-B4zoR_OT.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-money.html-zDobYpWx.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-number.html-BrYASHwJ.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-ok-button.html-aKAfAVej.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-page-card.html-DbmZUrmL.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-phone.html-CSir1Bmz.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-radio.html-CcjPtDPQ.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-region.html-BjflL8Lp.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-reset-button.html-BIbm-Bxg.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-search-button.html-DGPZ7Upn.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-select-checkbox.html-B2QHqpLm.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-select-dict-code.html-RAvoAHY8.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-select-dict-list.html-CfO7CSAs.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-select.html-BTjDCy3A.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/v-textarea.html-Bx7Ul3qN.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/index.html-C8SJBOEZ.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-app-icons.html-BNWFxpEn.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-business-line.html-mC6TWPgC.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-buttons.html-9IwNEyGN.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-checkbox.html-DCC7qogm.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-color-picker.html-W4cFg3c2.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-conditions.html-CdURDBGW.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-date-time.html-BMMlW0hw.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-dialog.html-BGS1KWyr.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-email.html-C1Mvf-hv.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-file-uploader.html-DR_OEijV.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-helper.html-C77adrfd.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-icon.html-Bw7GGtB6.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-idcard.html-D1fCuG5O.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-image-uploader.html-Jr0dV1J_.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-img-preview.html-ZLTkVnD-.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-inputs.html-CwiVXNwk.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-job.html-CO9NrLC8.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-loading.html-BVKi7R0S.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-operate-button.html-yTMxAzuA.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-page-card.html-CvCwxgk2.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-radio.html-fW-ri7mp.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-rank.html-Cxv4yhtB.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-router-view.html-qPwr8EX5.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select-application.html-BRDq_t5S.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select-connector-api.html-Bi5LsQ1D.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select-dict-code.html-BOquGBip.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select-role.html-BJVqGM8J.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select-unit.html-6S5qekQ5.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select-user.html--3DIjcNG.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-select.html-DiW1ErKC.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-switch.html-ebUoQK_R.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-text.html-BWLq2Ks8.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-title.html-d0zACsYO.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/z-user-unit-role-authority.html-aE7ye7pv.js" as="script"><link rel="prefetch" href="/zongheng-doc/assets/404.html-Co7LyN7_.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/zongheng-doc/"><!----><span class="vp-site-name" aria-hidden="true">纵横框架文档</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/zongheng-doc/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端框架"><span class="title">前端框架</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端框架"><span class="title">前端框架</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/guides/getting-started.html" aria-label="快速开始"><!--[--><!--[--><!--]--><!--]-->快速开始<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/components/pc/" aria-label="PC端组件"><!--[--><!--[--><!--]--><!--]-->PC端组件<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/components/mobile/" aria-label="移动端组件"><!--[--><!--[--><!--]--><!--]-->移动端组件<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/guides/state-management.html" aria-label="开发指南"><!--[--><!--[--><!--]--><!--]-->开发指南<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/architecture/overview.html" aria-label="架构设计"><!--[--><!--[--><!--]--><!--]-->架构设计<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="后端框架"><span class="title">后端框架</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="后端框架"><span class="title">后端框架</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/backend/getting-started.html" aria-label="快速开始"><!--[--><!--[--><!--]--><!--]-->快速开始<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/zongheng-doc/backend/api-design.html" aria-label="API设计"><!--[--><!--[--><!--]--><!--]-->API设计<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/backend/database.html" aria-label="数据库"><!--[--><!--[--><!--]--><!--]-->数据库<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/backend/middleware.html" aria-label="中间件"><!--[--><!--[--><!--]--><!--]-->中间件<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zongheng-doc/deployment.html" aria-label="部署指南"><!--[--><!--[--><!--]--><!--]-->部署指南<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Chandler924/zhongheng-doc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/zongheng-doc/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端框架"><span class="title">前端框架</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端框架"><span class="title">前端框架</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/guides/getting-started.html" aria-label="快速开始"><!--[--><!--[--><!--]--><!--]-->快速开始<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/components/pc/" aria-label="PC端组件"><!--[--><!--[--><!--]--><!--]-->PC端组件<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/components/mobile/" aria-label="移动端组件"><!--[--><!--[--><!--]--><!--]-->移动端组件<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/guides/state-management.html" aria-label="开发指南"><!--[--><!--[--><!--]--><!--]-->开发指南<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/frontend/architecture/overview.html" aria-label="架构设计"><!--[--><!--[--><!--]--><!--]-->架构设计<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="后端框架"><span class="title">后端框架</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="后端框架"><span class="title">后端框架</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/backend/getting-started.html" aria-label="快速开始"><!--[--><!--[--><!--]--><!--]-->快速开始<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/zongheng-doc/backend/api-design.html" aria-label="API设计"><!--[--><!--[--><!--]--><!--]-->API设计<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/backend/database.html" aria-label="数据库"><!--[--><!--[--><!--]--><!--]-->数据库<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/zongheng-doc/backend/middleware.html" aria-label="中间件"><!--[--><!--[--><!--]--><!--]-->中间件<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/zongheng-doc/deployment.html" aria-label="部署指南"><!--[--><!--[--><!--]--><!--]-->部署指南<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Chandler924/zhongheng-doc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">后端框架 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/zongheng-doc/backend/getting-started.html" aria-label="后端框架快速开始"><!--[--><!--[--><!--]--><!--]-->后端框架快速开始<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/zongheng-doc/backend/api-design.html" aria-label="API设计指南"><!--[--><!--[--><!--]--><!--]-->API设计指南<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/zongheng-doc/backend/database.html" aria-label="/backend/database.html"><!--[--><!--[--><!--]--><!--]-->/backend/database.html<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/zongheng-doc/backend/middleware.html" aria-label="/backend/middleware.html"><!--[--><!--[--><!--]--><!--]-->/backend/middleware.html<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="api设计指南" tabindex="-1"><a class="header-anchor" href="#api设计指南"><span>API设计指南</span></a></h1><p>本指南将帮助你设计RESTful API，遵循最佳实践和行业标准。</p><h2 id="restful-api原则" tabindex="-1"><a class="header-anchor" href="#restful-api原则"><span>RESTful API原则</span></a></h2><h3 id="_1-资源导向" tabindex="-1"><a class="header-anchor" href="#_1-资源导向"><span>1. 资源导向</span></a></h3><p>API应该围绕资源设计，而不是操作：</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// ✅ 好的设计</span></span>
<span class="line"><span class="token constant">GET</span>    <span class="token operator">/</span>api<span class="token operator">/</span>users          <span class="token comment">// 获取用户列表</span></span>
<span class="line"><span class="token constant">GET</span>    <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span>      <span class="token comment">// 获取特定用户</span></span>
<span class="line"><span class="token constant">POST</span>   <span class="token operator">/</span>api<span class="token operator">/</span>users          <span class="token comment">// 创建新用户</span></span>
<span class="line"><span class="token constant">PUT</span>    <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span>      <span class="token comment">// 更新用户</span></span>
<span class="line"><span class="token constant">DELETE</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span>      <span class="token comment">// 删除用户</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ❌ 避免的设计</span></span>
<span class="line"><span class="token constant">GET</span>    <span class="token operator">/</span>api<span class="token operator">/</span>getUsers</span>
<span class="line"><span class="token constant">POST</span>   <span class="token operator">/</span>api<span class="token operator">/</span>createUser</span>
<span class="line"><span class="token constant">POST</span>   <span class="token operator">/</span>api<span class="token operator">/</span>updateUser</span>
<span class="line"><span class="token constant">POST</span>   <span class="token operator">/</span>api<span class="token operator">/</span>deleteUser</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-http方法语义" tabindex="-1"><a class="header-anchor" href="#_2-http方法语义"><span>2. HTTP方法语义</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// GET - 获取资源</span></span>
<span class="line"><span class="token constant">GET</span> <span class="token operator">/</span>api<span class="token operator">/</span>users</span>
<span class="line"><span class="token constant">GET</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span></span>
<span class="line"><span class="token constant">GET</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span><span class="token operator">/</span>posts</span>
<span class="line"></span>
<span class="line"><span class="token comment">// POST - 创建资源</span></span>
<span class="line"><span class="token constant">POST</span> <span class="token operator">/</span>api<span class="token operator">/</span>users</span>
<span class="line"><span class="token constant">POST</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span><span class="token operator">/</span>posts</span>
<span class="line"></span>
<span class="line"><span class="token comment">// PUT - 完整更新资源</span></span>
<span class="line"><span class="token constant">PUT</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// PATCH - 部分更新资源</span></span>
<span class="line"><span class="token constant">PATCH</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// DELETE - 删除资源</span></span>
<span class="line"><span class="token constant">DELETE</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-状态码使用" tabindex="-1"><a class="header-anchor" href="#_3-状态码使用"><span>3. 状态码使用</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// 成功响应</span></span>
<span class="line"><span class="token number">200</span> <span class="token constant">OK</span>          <span class="token comment">// 请求成功</span></span>
<span class="line"><span class="token number">201</span> Created     <span class="token comment">// 资源创建成功</span></span>
<span class="line"><span class="token number">204</span> No Content  <span class="token comment">// 删除成功，无返回内容</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 客户端错误</span></span>
<span class="line"><span class="token number">400</span> Bad Request     <span class="token comment">// 请求参数错误</span></span>
<span class="line"><span class="token number">401</span> Unauthorized    <span class="token comment">// 未认证</span></span>
<span class="line"><span class="token number">403</span> Forbidden       <span class="token comment">// 无权限</span></span>
<span class="line"><span class="token number">404</span> Not Found       <span class="token comment">// 资源不存在</span></span>
<span class="line"><span class="token number">409</span> Conflict        <span class="token comment">// 资源冲突</span></span>
<span class="line"><span class="token number">422</span> Unprocessable Entity <span class="token comment">// 数据验证失败</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 服务器错误</span></span>
<span class="line"><span class="token number">500</span> Internal Server Error <span class="token comment">// 服务器内部错误</span></span>
<span class="line"><span class="token number">502</span> Bad Gateway          <span class="token comment">// 网关错误</span></span>
<span class="line"><span class="token number">503</span> Service Unavailable  <span class="token comment">// 服务不可用</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="请求和响应格式" tabindex="-1"><a class="header-anchor" href="#请求和响应格式"><span>请求和响应格式</span></a></h2><h3 id="统一响应格式" tabindex="-1"><a class="header-anchor" href="#统一响应格式"><span>统一响应格式</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// 成功响应</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan@example.com&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;操作成功&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 错误响应</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;USER_NOT_FOUND&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户不存在&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;userId&quot;</span><span class="token operator">:</span> <span class="token number">123</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 分页响应</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;用户2&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;pagination&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;pageSize&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;totalPages&quot;</span><span class="token operator">:</span> <span class="token number">5</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="请求参数" tabindex="-1"><a class="header-anchor" href="#请求参数"><span>请求参数</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// 查询参数</span></span>
<span class="line"><span class="token constant">GET</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">?</span>page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>pageSize<span class="token operator">=</span><span class="token number">20</span><span class="token operator">&amp;</span>sort<span class="token operator">=</span>name<span class="token operator">&amp;</span>order<span class="token operator">=</span>asc</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 路径参数</span></span>
<span class="line"><span class="token constant">GET</span> <span class="token operator">/</span>api<span class="token operator">/</span>users<span class="token operator">/</span><span class="token number">123</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 请求体</span></span>
<span class="line"><span class="token constant">POST</span> <span class="token operator">/</span>api<span class="token operator">/</span>users</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan@example.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">25</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现示例" tabindex="-1"><a class="header-anchor" href="#实现示例"><span>实现示例</span></a></h2><h3 id="用户api控制器" tabindex="-1"><a class="header-anchor" href="#用户api控制器"><span>用户API控制器</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// controllers/UserController.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@zongheng/backend&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../services/UserService&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> validateUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../validators/userValidator&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 获取用户列表</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> search<span class="token punctuation">,</span> sort<span class="token punctuation">,</span> order <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query</span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> UserService<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        page<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>page <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        pageSize<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>pageSize <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        search<span class="token operator">:</span> search <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">        sort<span class="token operator">:</span> sort <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">        order<span class="token operator">:</span> order <span class="token keyword">as</span> <span class="token string">&#39;asc&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;desc&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        data<span class="token operator">:</span> result<span class="token punctuation">.</span>users<span class="token punctuation">,</span></span>
<span class="line">        pagination<span class="token operator">:</span> result<span class="token punctuation">.</span>pagination</span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;INTERNAL_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;获取用户列表失败&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 获取单个用户</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params</span>
<span class="line">      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> UserService<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            code<span class="token operator">:</span> <span class="token string">&#39;USER_NOT_FOUND&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            message<span class="token operator">:</span> <span class="token string">&#39;用户不存在&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        data<span class="token operator">:</span> user</span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;INTERNAL_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;获取用户失败&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 创建用户</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 验证请求数据</span></span>
<span class="line">      <span class="token keyword">const</span> validation <span class="token operator">=</span> <span class="token function">validateUser</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validation<span class="token punctuation">.</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            code<span class="token operator">:</span> <span class="token string">&#39;VALIDATION_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            message<span class="token operator">:</span> <span class="token string">&#39;数据验证失败&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            details<span class="token operator">:</span> validation<span class="token punctuation">.</span>errors</span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> UserService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        data<span class="token operator">:</span> user<span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> <span class="token string">&#39;用户创建成功&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token string">&#39;DUPLICATE_EMAIL&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            code<span class="token operator">:</span> <span class="token string">&#39;DUPLICATE_EMAIL&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            message<span class="token operator">:</span> <span class="token string">&#39;邮箱已存在&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;INTERNAL_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;创建用户失败&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 更新用户</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params</span>
<span class="line">      </span>
<span class="line">      <span class="token comment">// 验证请求数据</span></span>
<span class="line">      <span class="token keyword">const</span> validation <span class="token operator">=</span> <span class="token function">validateUser</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> partial<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validation<span class="token punctuation">.</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            code<span class="token operator">:</span> <span class="token string">&#39;VALIDATION_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            message<span class="token operator">:</span> <span class="token string">&#39;数据验证失败&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            details<span class="token operator">:</span> validation<span class="token punctuation">.</span>errors</span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> UserService<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            code<span class="token operator">:</span> <span class="token string">&#39;USER_NOT_FOUND&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            message<span class="token operator">:</span> <span class="token string">&#39;用户不存在&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        data<span class="token operator">:</span> user<span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> <span class="token string">&#39;用户更新成功&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;INTERNAL_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;更新用户失败&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 删除用户</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params</span>
<span class="line">      <span class="token keyword">const</span> deleted <span class="token operator">=</span> <span class="token keyword">await</span> UserService<span class="token punctuation">.</span><span class="token function">deleteUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deleted<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            code<span class="token operator">:</span> <span class="token string">&#39;USER_NOT_FOUND&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            message<span class="token operator">:</span> <span class="token string">&#39;用户不存在&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;INTERNAL_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;删除用户失败&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据验证" tabindex="-1"><a class="header-anchor" href="#数据验证"><span>数据验证</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// validators/userValidator.ts</span></span>
<span class="line"><span class="token keyword">import</span> Joi <span class="token keyword">from</span> <span class="token string">&#39;joi&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> userSchema <span class="token operator">=</span> Joi<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  name<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  email<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  age<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  phone<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1[3-9]\d{9}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  address<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    street<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    city<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    country<span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateUser</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token punctuation">{</span> partial<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> schema <span class="token operator">=</span> options<span class="token punctuation">.</span>partial <span class="token operator">?</span> userSchema<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>userSchema<span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> schema<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> userSchema</span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span> abortEarly<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      isValid<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      errors<span class="token operator">:</span> error<span class="token punctuation">.</span>details<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>detail <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        field<span class="token operator">:</span> detail<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> detail<span class="token punctuation">.</span>message</span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    isValid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    data<span class="token operator">:</span> value</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="服务层实现" tabindex="-1"><a class="header-anchor" href="#服务层实现"><span>服务层实现</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// services/UserService.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> UserModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../models/UserModel&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> AppError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/AppError&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>options<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    page<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">    pageSize<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">    search<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">    sort<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">    order<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&#39;asc&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;desc&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> page<span class="token punctuation">,</span> pageSize<span class="token punctuation">,</span> search<span class="token punctuation">,</span> sort <span class="token operator">=</span> <span class="token string">&#39;createdAt&#39;</span><span class="token punctuation">,</span> order <span class="token operator">=</span> <span class="token string">&#39;desc&#39;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> options</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> query<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 搜索条件</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>search<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      query<span class="token punctuation">.</span>$or <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> $regex<span class="token operator">:</span> search<span class="token punctuation">,</span> $options<span class="token operator">:</span> <span class="token string">&#39;i&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token punctuation">{</span> $regex<span class="token operator">:</span> search<span class="token punctuation">,</span> $options<span class="token operator">:</span> <span class="token string">&#39;i&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 计算分页</span></span>
<span class="line">    <span class="token keyword">const</span> skip <span class="token operator">=</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize</span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 执行查询</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">[</span>users<span class="token punctuation">,</span> total<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">      UserModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>sort<span class="token punctuation">]</span><span class="token operator">:</span> order <span class="token operator">===</span> <span class="token string">&#39;asc&#39;</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;-password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 排除密码字段</span></span>
<span class="line">      UserModel<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      users<span class="token punctuation">,</span></span>
<span class="line">      pagination<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        page<span class="token punctuation">,</span></span>
<span class="line">        pageSize<span class="token punctuation">,</span></span>
<span class="line">        total<span class="token punctuation">,</span></span>
<span class="line">        totalPages<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>total <span class="token operator">/</span> pageSize<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> UserModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;-password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> user</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span>userData<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 检查邮箱是否已存在</span></span>
<span class="line">    <span class="token keyword">const</span> existingUser <span class="token operator">=</span> <span class="token keyword">await</span> UserModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> userData<span class="token punctuation">.</span>email <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>existingUser<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AppError</span><span class="token punctuation">(</span><span class="token string">&#39;DUPLICATE_EMAIL&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;邮箱已存在&#39;</span><span class="token punctuation">,</span> <span class="token number">409</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">transform</span><span class="token operator">:</span> <span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">delete</span> ret<span class="token punctuation">.</span>password</span>
<span class="line">      <span class="token keyword">return</span> ret</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> updateData<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> UserModel<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span></span>
<span class="line">      id<span class="token punctuation">,</span></span>
<span class="line">      updateData<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> runValidators<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;-password&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> user</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> UserModel<span class="token punctuation">.</span><span class="token function">findByIdAndDelete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>result</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件"><span>中间件</span></a></h2><h3 id="认证中间件" tabindex="-1"><a class="header-anchor" href="#认证中间件"><span>认证中间件</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware/auth.ts</span></span>
<span class="line"><span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">&#39;jsonwebtoken&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@zongheng/backend&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">authMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token operator">?.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;Bearer &#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;NO_TOKEN&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;未提供认证令牌&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">any</span></span>
<span class="line">    req<span class="token punctuation">.</span>user <span class="token operator">=</span> decoded</span>
<span class="line">    </span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        code<span class="token operator">:</span> <span class="token string">&#39;INVALID_TOKEN&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> <span class="token string">&#39;无效的认证令牌&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="权限中间件" tabindex="-1"><a class="header-anchor" href="#权限中间件"><span>权限中间件</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware/permission.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requirePermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span>permission<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;UNAUTHORIZED&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;未认证&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>permissions<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">        error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          code<span class="token operator">:</span> <span class="token string">&#39;FORBIDDEN&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> <span class="token string">&#39;权限不足&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="错误处理中间件" tabindex="-1"><a class="header-anchor" href="#错误处理中间件"><span>错误处理中间件</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware/errorHandler.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">errorHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">  error<span class="token operator">:</span> Error<span class="token punctuation">,</span></span>
<span class="line">  req<span class="token operator">:</span> Request<span class="token punctuation">,</span></span>
<span class="line">  res<span class="token operator">:</span> Response<span class="token punctuation">,</span></span>
<span class="line">  next<span class="token operator">:</span> NextFunction</span>
<span class="line"><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;API Error:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 自定义错误</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name">AppError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        code<span class="token operator">:</span> error<span class="token punctuation">.</span>code<span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span></span>
<span class="line">        details<span class="token operator">:</span> error<span class="token punctuation">.</span>details</span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 数据库验证错误</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;ValidationError&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        code<span class="token operator">:</span> <span class="token string">&#39;VALIDATION_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> <span class="token string">&#39;数据验证失败&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        details<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          field<span class="token operator">:</span> err<span class="token punctuation">.</span>path<span class="token punctuation">,</span></span>
<span class="line">          message<span class="token operator">:</span> err<span class="token punctuation">.</span>message</span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 默认错误</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      code<span class="token operator">:</span> <span class="token string">&#39;INTERNAL_ERROR&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      message<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> </span>
<span class="line">        <span class="token operator">?</span> <span class="token string">&#39;服务器内部错误&#39;</span> </span>
<span class="line">        <span class="token operator">:</span> error<span class="token punctuation">.</span>message</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="api文档" tabindex="-1"><a class="header-anchor" href="#api文档"><span>API文档</span></a></h2><h3 id="openapi-swagger集成" tabindex="-1"><a class="header-anchor" href="#openapi-swagger集成"><span>OpenAPI/Swagger集成</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// swagger.ts</span></span>
<span class="line"><span class="token keyword">import</span> swaggerJsdoc <span class="token keyword">from</span> <span class="token string">&#39;swagger-jsdoc&#39;</span></span>
<span class="line"><span class="token keyword">import</span> swaggerUi <span class="token keyword">from</span> <span class="token string">&#39;swagger-ui-express&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  definition<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    openapi<span class="token operator">:</span> <span class="token string">&#39;3.0.0&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    info<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      title<span class="token operator">:</span> <span class="token string">&#39;纵横框架API&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      version<span class="token operator">:</span> <span class="token string">&#39;1.0.0&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      description<span class="token operator">:</span> <span class="token string">&#39;纵横框架的RESTful API文档&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    servers<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        url<span class="token operator">:</span> <span class="token string">&#39;http://localhost:3000/api&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        description<span class="token operator">:</span> <span class="token string">&#39;开发服务器&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    components<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      securitySchemes<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        bearerAuth<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          type<span class="token operator">:</span> <span class="token string">&#39;http&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          scheme<span class="token operator">:</span> <span class="token string">&#39;bearer&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          bearerFormat<span class="token operator">:</span> <span class="token string">&#39;JWT&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  apis<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./routes/*.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./controllers/*.ts&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> specs <span class="token operator">=</span> <span class="token function">swaggerJsdoc</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 在app.ts中使用</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/api-docs&#39;</span><span class="token punctuation">,</span> swaggerUi<span class="token punctuation">.</span>serve<span class="token punctuation">,</span> swaggerUi<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>specs<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="api注释示例" tabindex="-1"><a class="header-anchor" href="#api注释示例"><span>API注释示例</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@swagger</span></span>
<span class="line"> * /api/users:</span>
<span class="line"> *   get:</span>
<span class="line"> *     summary: 获取用户列表</span>
<span class="line"> *     tags: [Users]</span>
<span class="line"> *     parameters:</span>
<span class="line"> *       - in: query</span>
<span class="line"> *         name: page</span>
<span class="line"> *         schema:</span>
<span class="line"> *           type: integer</span>
<span class="line"> *           default: 1</span>
<span class="line"> *         description: 页码</span>
<span class="line"> *       - in: query</span>
<span class="line"> *         name: pageSize</span>
<span class="line"> *         schema:</span>
<span class="line"> *           type: integer</span>
<span class="line"> *           default: 20</span>
<span class="line"> *         description: 每页数量</span>
<span class="line"> *     responses:</span>
<span class="line"> *       200:</span>
<span class="line"> *         description: 成功获取用户列表</span>
<span class="line"> *         content:</span>
<span class="line"> *           application/json:</span>
<span class="line"> *             schema:</span>
<span class="line"> *               type: object</span>
<span class="line"> *               properties:</span>
<span class="line"> *                 success:</span>
<span class="line"> *                   type: boolean</span>
<span class="line"> *                 data:</span>
<span class="line"> *                   type: array</span>
<span class="line"> *                   items:</span>
<span class="line"> *                     $ref: &#39;#/components/schemas/User&#39;</span>
<span class="line"> *                 pagination:</span>
<span class="line"> *                   $ref: &#39;#/components/schemas/Pagination&#39;</span>
<span class="line"> */</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="性能优化" tabindex="-1"><a class="header-anchor" href="#性能优化"><span>性能优化</span></a></h2><h3 id="_1-缓存策略" tabindex="-1"><a class="header-anchor" href="#_1-缓存策略"><span>1. 缓存策略</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware/cache.ts</span></span>
<span class="line"><span class="token keyword">import</span> NodeCache <span class="token keyword">from</span> <span class="token string">&#39;node-cache&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stdTTL<span class="token operator">:</span> <span class="token number">600</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 10分钟缓存</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">cacheMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ttl<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> key <span class="token operator">=</span> req<span class="token punctuation">.</span>originalUrl</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> cached <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 重写res.json以缓存响应</span></span>
<span class="line">    <span class="token keyword">const</span> originalJson <span class="token operator">=</span> res<span class="token punctuation">.</span>json</span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function-variable function">json</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> body<span class="token punctuation">,</span> ttl<span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">originalJson</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-请求限流" tabindex="-1"><a class="header-anchor" href="#_2-请求限流"><span>2. 请求限流</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware/rateLimit.ts</span></span>
<span class="line"><span class="token keyword">import</span> rateLimit <span class="token keyword">from</span> <span class="token string">&#39;express-rate-limit&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createRateLimit</span> <span class="token operator">=</span> <span class="token punctuation">(</span>windowMs<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">rateLimit</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    windowMs<span class="token punctuation">,</span></span>
<span class="line">    max<span class="token punctuation">,</span></span>
<span class="line">    message<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">      error<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        code<span class="token operator">:</span> <span class="token string">&#39;RATE_LIMIT_EXCEEDED&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        message<span class="token operator">:</span> <span class="token string">&#39;请求过于频繁，请稍后再试&#39;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用示例</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/api/auth&#39;</span><span class="token punctuation">,</span> <span class="token function">createRateLimit</span><span class="token punctuation">(</span><span class="token number">15</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 15分钟内最多5次请求</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-数据分页" tabindex="-1"><a class="header-anchor" href="#_3-数据分页"><span>3. 数据分页</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// utils/pagination.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PaginationOptions</span> <span class="token punctuation">{</span></span>
<span class="line">  page<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  pageSize<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  sort<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  order<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&#39;asc&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;desc&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PaginationResult<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">  pagination<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    page<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">    pageSize<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">    total<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">    totalPages<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">    hasNext<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="line">    hasPrev<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createPaginationResult</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  total<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span></span>
<span class="line">  options<span class="token operator">:</span> PaginationOptions</span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> PaginationResult<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> page<span class="token punctuation">,</span> pageSize <span class="token punctuation">}</span> <span class="token operator">=</span> options</span>
<span class="line">  <span class="token keyword">const</span> totalPages <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>total <span class="token operator">/</span> pageSize<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    data<span class="token punctuation">,</span></span>
<span class="line">    pagination<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      page<span class="token punctuation">,</span></span>
<span class="line">      pageSize<span class="token punctuation">,</span></span>
<span class="line">      total<span class="token punctuation">,</span></span>
<span class="line">      totalPages<span class="token punctuation">,</span></span>
<span class="line">      hasNext<span class="token operator">:</span> page <span class="token operator">&lt;</span> totalPages<span class="token punctuation">,</span></span>
<span class="line">      hasPrev<span class="token operator">:</span> page <span class="token operator">&gt;</span> <span class="token number">1</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h2><h3 id="api测试" tabindex="-1"><a class="header-anchor" href="#api测试"><span>API测试</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// tests/api/users.test.ts</span></span>
<span class="line"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">&#39;supertest&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../app&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;User API&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;GET /api/users&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should return user list&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pagination<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should support pagination&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users?page=2&amp;pageSize=10&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;POST /api/users&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should create user with valid data&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        name<span class="token operator">:</span> <span class="token string">&#39;测试用户&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        email<span class="token operator">:</span> <span class="token string">&#39;test@example.com&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        age<span class="token operator">:</span> <span class="token number">25</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>userData<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should return validation error for invalid data&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> invalidData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        name<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 空名称</span></span>
<span class="line">        email<span class="token operator">:</span> <span class="token string">&#39;invalid-email&#39;</span> <span class="token comment">// 无效邮箱</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>invalidData<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>error<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;VALIDATION_ERROR&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="最佳实践总结" tabindex="-1"><a class="header-anchor" href="#最佳实践总结"><span>最佳实践总结</span></a></h2><ol><li><strong>RESTful设计</strong>：遵循REST原则，使用正确的HTTP方法和状态码</li><li><strong>统一响应格式</strong>：使用一致的响应结构</li><li><strong>数据验证</strong>：在服务端验证所有输入数据</li><li><strong>错误处理</strong>：提供清晰的错误信息和错误码</li><li><strong>安全性</strong>：实现认证、授权和输入验证</li><li><strong>性能优化</strong>：使用缓存、分页和请求限流</li><li><strong>文档化</strong>：提供完整的API文档</li><li><strong>测试</strong>：编写全面的API测试</li><li><strong>版本控制</strong>：为API版本变更制定策略</li><li><strong>监控</strong>：记录API使用情况和性能指标</li></ol></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2025-09-17T07:49:00.000Z" data-allow-mismatch>2025/9/17 15:49</time></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/zongheng-doc/backend/getting-started.html" aria-label="后端框架快速开始"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">后端框架快速开始</span></div><!--]--></a><a class="route-link auto-link next" href="/zongheng-doc/backend/database.html" aria-label="/backend/database.html"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">/backend/database.html</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/zongheng-doc/assets/app-Ct3TXeMg.js" defer></script>
  </body>
</html>
